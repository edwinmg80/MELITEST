
----------------------------------------
--------DATOS DEL SERVIDIOR Y USUARIO 
---------------------------------------

--Server desarrollo: mt-dev-sql-server.database.windows.net
--Database: 3as-dev-col-db

--craer schema meli y usuario 
create schema meli;

--craer usuario local
CREATE USER [usermeli] 
WITH PASSWORD = 'Wlke*omxzoytjka9', 
DEFAULT_SCHEMA = meli; 



-------------------------------------------
----CREACION TABLAS------------
--------------------------------------

/****** Object:  Table [meli].[CUSTOMER]  Script Date: 4/1/2023 *****/
CREATE TABLE [meli].[CUSTOMER](
	[ID] [varchar](10) NOT NULL,
	[TIPO_CLIENTE] [varchar](20) NULL,
	[NOMBRE] [varchar](50) NULL,
	[APELLIDO] [varchar](50) NULL,
	[EMAIL] [varchar](50) NULL,
	[SEXO] [varchar](20) NULL,
	[DIRECCION] [varchar](50) NULL,
	[PAIS] [varchar](50) NULL,
	[FECHA_NACIMIENTO] DATE,
	[TELEFONO] [varchar](50) NULL,
	[CREADO_EL]  DATE NULL,
	[LASTUPDATE]  DATETIME NULL,
	[MODIFICADO_POR] [varchar](50) NULL
) ON [PRIMARY]

/****** Object:  Table [meli].[ITEM]  Script Date: 4/1/2023 *****/
CREATE TABLE [meli].[ITEM](
	[CODIGO] [varchar](10) NOT NULL,
	[NOMBRE_ITEM] [varchar](200) NULL,
	[CATEGORIA] [varchar](50) NULL,
	[VALOR_UNIT] DECIMAL(15,2) NULL,
	[ESTADO] [varchar](50) NULL,
	[FECHA_BAJA] DATETIME NULL,
	[CREADO_EL]  DATE NULL,
	[LASTUPDATE]  DATETIME NULL,
	[MODIFICADO_POR] [VARCHAR](50) NULL
) ON [PRIMARY]

/****** Object:  Table [meli].[CATEGORY]  Script Date: 4/1/2023 *****/
CREATE TABLE [meli].[CATEGORY](
    [ID] [varchar](10) NOT NULL,
	[CATEGORIA] [varchar](50) NULL,
	[DESCRIPCION_CATEGORIA] [varchar](500) NULL,
	[PATH] [varchar](500) NULL,
	[CREADO_EL]  DATE NULL,
	[LASTUPDATE]  DATETIME NULL,
	[MODIFICADO_POR] [varchar](50) NULL
) ON [PRIMARY]

/****** Object:  Table [meli].[ORDER]  Script Date: 4/1/2023 *****/
CREATE TABLE [meli].[ORDER](
	[N_ORDER] [varchar](10) NOT NULL,
	[FECHA_ORDER] DATE NULL,
	[HORA_ORDEN] TIME NULL,
	[ID_CUSTOMER] [varchar](10) NULL,
	[CODIGO_ITEM] [varchar](10) NULL,
	[CANTIDAD]  INT,
	[VALOR_UNIT] DECIMAL(15,2) NULL,
	[VALOR_TOTAL] DECIMAL(15,2) NULL,
	[CREADO_EL]  DATE NULL,
	[LASTUPDATE]  DATETIME NULL,
	[MODIFICADO_POR] [varchar](50) NULL
) ON [PRIMARY]



--HISTORICO_ITEM, tabla de hitorico de ITEM
CREATE TABLE [meli].[HISTORICO_ITEM](
	[CODIGO] [varchar](10) NOT NULL,
	[VALOR_UNIT] DECIMAL(15,2) NULL,
	[ESTADO] [varchar](50) NULL,
	[FECHA_BAJA] DATETIME NULL,
	[MODIFICADO_POR] [VARCHAR](50) NULL,
	[LOAD_DATE]DATE NULL
) ON [PRIMARY]

---CATEGORY_V2, tabla alterna de categoria sin duplicados
CREATE TABLE [meli].[CATEGORY_V2](
	[ID] [varchar](10) NULL,
	[CATEGORIA] [varchar](50) NULL,
	[DESCRIPCION_CATEGORIA] [varchar](500) NULL,
	[PATH] [varchar](500) NULL,
	[CREADO_EL] [date] NULL,
	[LASTUPDATE] [datetime] NULL,
	[MODIFICADO_POR] [varchar](50) NULL
) ON [PRIMARY];

--asiganr permisos lectura usuario local
Grant Select on object::meli.CATEGORY to usermeli; 
Grant Select on object::meli.CATEGORY_v2 to usermeli;
Grant Select on object::meli.CUSTOMER to usermeli; 
Grant Select on object::meli.HISTORICO_ITEM to usermeli; 
Grant Select on object::meli.ITEM to usermeli; 
Grant Select on object::meli.[ORDER] to usermeli; 


----------------------------------------------
------------INSERTAR REGISTROS DE PRUEBAS
-----------------------------------------------

--meli.CUSTOMER
DELETE FROM meli.CUSTOMER;
SELECT * FROM meli.CUSTOMER;

INSERT INTO meli.CUSTOMER ([ID],[TIPO_CLIENTE],[NOMBRE],[APELLIDO],[EMAIL],[SEXO],[DIRECCION],[PAIS],[FECHA_NACIMIENTO],[TELEFONO],[CREADO_EL],[LASTUPDATE],[MODIFICADO_POR])
VALUES
('0000000001','BUYER','EDWIN','MUNOZ','edwinmg80@hotmail.com','M','CALLE 37 # 42A-58','COL','1980.08.09','3136658706',GETDATE(),GETDATE(),'SYSTEMA'),
('0000000002','BUYER','Martín','González','Martín@hotmail.com','M','CALLE 37 # 42A-59','COL','1996.07.11','5555555555',GETDATE(),GETDATE(),'SYSTEMA'),
('0000000003','BUYER','Ana','Torres','Ana@hotmail.com','F','CALLE 37 # 42A-60','COL','2020.03.07','5555555555',GETDATE(),GETDATE(),'SYSTEMA'),
('0000000004','BUYER','Miguel','Rodríguez','Miguel@hotmail.com','M','CALLE 37 # 42A-61','COL','1998.03.29','5555555555',GETDATE(),GETDATE(),'SYSTEMA'),
('0000000005','BUYER','Valeria','Moreno','Valeria@hotmail.com','F','CALLE 37 # 42A-62','COL','1995.03.19','5555555555',GETDATE(),GETDATE(),'SYSTEMA'),
('0000000006','BUYER','Daniel','García','Daniel@hotmail.com','M','CALLE 37 # 42A-63','COL','1998.02.04','5555555555',GETDATE(),GETDATE(),'SYSTEMA'),
('0000000007','BUYER','Carmen','Sánchez','Carmen@hotmail.com','F','CALLE 37 # 42A-64','COL','1997.01.13','5555555555',GETDATE(),GETDATE(),'SYSTEMA'),
('0000000008','BUYER','Diego','López','Diego@hotmail.com','M','CALLE 37 # 42A-65','COL','2000.01.25','5555555555',GETDATE(),GETDATE(),'SYSTEMA'),
('0000000009','BUYER','Lucía','Pérez','Lucía@hotmail.com','F','CALLE 37 # 42A-66','COL','1996.01.10','5555555555',GETDATE(),GETDATE(),'SYSTEMA'),
('0000000010','BUYER','Pablo','Martínez','Pablo@hotmail.com','M','CALLE 37 # 42A-67','COL','1996.01.10','5555555555',GETDATE(),GETDATE(),'SYSTEMA')


--[meli].[CATEGORY]
DELETE FROM [meli].[CATEGORY];
SELECT * FROM [meli].[CATEGORY];

INSERT INTO [meli].[CATEGORY] ([ID],[CATEGORIA],[DESCRIPCION_CATEGORIA],[PATH],[CREADO_EL],[LASTUPDATE],[MODIFICADO_POR])
VALUES
('1','CELULARES','CELULARES Y SMARTPHONES','TECNOLOGIA - CELULARES - CELULARES Y SMARTPHONES',GETDATE(),GETDATE(),'SYSTEMA'),
('2','PORTATILES','COMPUTADORES PORTATILES','TECNOLOGIA - PORTATILES - COMPUTADORES PORTATILES',GETDATE(),GETDATE(),'SYSTEMA'),
('3','TELEVISORES','TELEVISORES Y SMART TV','TECNOLOGIA - TELEVISORES - TELEVISORES Y SMART TV',GETDATE(),GETDATE(),'SYSTEMA'),
('3','TELEVISORES','TELEVISORES Y SMART LED','TECNOLOGIA - TELEVISORES - TELEVISORES Y SMART LED',GETDATE(),GETDATE(),'SYSTEMA') --este registro duplica el error de tabla

--[meli].[ITEM]
DELETE FROM [meli].[ITEM];
SELECT * FROM [meli].[ITEM];

INSERT INTO [meli].[ITEM]([CODIGO],[NOMBRE_ITEM],[CATEGORIA],[VALOR_UNIT],[ESTADO],[FECHA_BAJA],[CREADO_EL],[LASTUPDATE],[MODIFICADO_POR])
VALUES
('1','MOTOROLA G42','1',700000,'ACTIVO',NULL,GETDATE()-45,GETDATE()-45,'SYSTEMA'),
('2','iPhone 11 128 GB BLANCO','1',2600000,'ACTIVO',NULL,GETDATE()-45,GETDATE()-45,'SYSTEMA'),
('3','iPhone 11 128 GB NEGRO','1',2600000,'ACTIVO',NULL,GETDATE()-45,GETDATE()-45,'SYSTEMA'),
('4','iPhone 11 128 GB ROSA','1',2600000,'ACTIVO',NULL,GETDATE()-45,GETDATE()-45,'SYSTEMA'),
('5','SAMSUNG Galaxy M23 128GB 5G Azul','1',1800000,'ACTIVO',NULL,GETDATE()-45,GETDATE()-45,'SYSTEMA'),
('6','SAMSUNG Galaxy M23 128GB 5G ROJO','1',1800000,'ACTIVO',NULL,GETDATE()-45,GETDATE()-45,'SYSTEMA'),
('7','HP Pavilion 15.6" Pulgadas eg0500la ','2',2550000,'ACTIVO',NULL,GETDATE()-45,GETDATE()-45,'SYSTEMA'),
('8','MacBook Air de 13" Pulgadas MGN93LA/A ','2',3500000,'ACTIVO',NULL,GETDATE()-45,GETDATE()-45,'SYSTEMA'),
('9','ACER 15.6" Pulgadas 31KC','2',1110000,'ACTIVO',NULL,GETDATE()-45,GETDATE()-45,'SYSTEMA'),
('10','TV SAMSUNG 70 Pulgadas ','3',4350000,'ACTIVO',NULL,GETDATE()-45,GETDATE()-45,'SYSTEMA'),
('11','TV XIAOMI 43 Pulgadas ','3',3200000,'ACTIVO',NULL,GETDATE()-45,GETDATE()-45,'SYSTEMA')

--actualizacion registros, cambio precio
UPDATE [meli].[ITEM] SET VALOR_UNIT = 2900000, LASTUPDATE = GETDATE()-30 WHERE CODIGO = '4';
UPDATE [meli].[ITEM] SET VALOR_UNIT = 2100000, LASTUPDATE = GETDATE()-30 WHERE CODIGO = '6';
UPDATE [meli].[ITEM] SET VALOR_UNIT = 3300000, LASTUPDATE = GETDATE()-30 WHERE CODIGO = '11';
UPDATE [meli].[ITEM] SET VALOR_UNIT = 3000000, LASTUPDATE = GETDATE()-10 WHERE CODIGO = '4';
UPDATE [meli].[ITEM] SET VALOR_UNIT = 2200000, LASTUPDATE = GETDATE()-10 WHERE CODIGO = '6';
UPDATE [meli].[ITEM] SET VALOR_UNIT = 3500000, LASTUPDATE = GETDATE()-10 WHERE CODIGO = '11';
--actualizacion registros, inactivos
UPDATE [meli].[ITEM] SET ESTADO = 'INACTIVO', FECHA_BAJA = GETDATE()-5, LASTUPDATE = GETDATE()-5 WHERE CODIGO = '4';
UPDATE [meli].[ITEM] SET ESTADO = 'INACTIVO', FECHA_BAJA = GETDATE()-5, LASTUPDATE = GETDATE()-5 WHERE CODIGO = '6';
UPDATE [meli].[ITEM] SET ESTADO = 'INACTIVO', FECHA_BAJA = GETDATE()-5, LASTUPDATE = GETDATE()-5 WHERE CODIGO = '11';

--[meli].[ORDER]
DELETE FROM [meli].[ORDER];
SELECT * FROM [meli].[ORDER];

INSERT INTO [meli].[ORDER] ([N_ORDER],[FECHA_ORDER],[HORA_ORDEN],[ID_CUSTOMER],[CODIGO_ITEM],[CANTIDAD],[VALOR_UNIT],[VALOR_TOTAL],[CREADO_EL],[LASTUPDATE],[MODIFICADO_POR])
VALUES
('5001',GETDATE(),GETDATE(),1,1,2,700000,1400000,GETDATE(),GETDATE(),'SYSTEMA'),
('5002',GETDATE(),GETDATE(),1,2,1,2600000,2600000,GETDATE(),GETDATE(),'SYSTEMA'),
('5003',GETDATE(),GETDATE(),20,7,1,2550000,2550000,GETDATE(),GETDATE(),'SYSTEMA'),
('5004',GETDATE(),GETDATE(),18,9,3,1110000,3330000,GETDATE(),GETDATE(),'SYSTEMA'),
('5005',GETDATE(),GETDATE(),1,12,1,3200000,3200000,GETDATE(),GETDATE(),'SYSTEMA'),
('5006',GETDATE(),GETDATE(),3,2,2,2600000,5200000,GETDATE(),GETDATE(),'SYSTEMA'),
('5007',GETDATE(),GETDATE(),5,2,3,2600000,7800000,GETDATE(),GETDATE(),'SYSTEMA'),
('5008',GETDATE(),GETDATE(),4,2,3,2600000,7800000,GETDATE(),GETDATE(),'SYSTEMA'),
('5009',GETDATE(),GETDATE(),4,2,1,2600000,2600000,GETDATE(),GETDATE(),'SYSTEMA'),
('5010',GETDATE(),GETDATE(),7,2,2,2600000,5200000,GETDATE(),GETDATE(),'SYSTEMA'),
('5011',GETDATE(),GETDATE(),9,4,1,2600000,2600000,GETDATE(),GETDATE(),'SYSTEMA'),
('5012',GETDATE(),GETDATE(),13,5,1,1800000,1800000,GETDATE(),GETDATE(),'SYSTEMA'),
('5013',GETDATE(),GETDATE(),13,7,1,2550000,2550000,GETDATE(),GETDATE(),'SYSTEMA'),
('5014',GETDATE(),GETDATE(),20,8,1,3500000,3500000,GETDATE(),GETDATE(),'SYSTEMA'),
('5015',GETDATE(),GETDATE(),14,9,3,1110000,3330000,GETDATE(),GETDATE(),'SYSTEMA'),
('5016',GETDATE(),GETDATE(),11,11,4,3200000,12800000,GETDATE(),GETDATE(),'SYSTEMA'),
('5017',GETDATE(),GETDATE(),5,12,7,3200000,22400000,GETDATE(),GETDATE(),'SYSTEMA'),
('5018',GETDATE(),GETDATE(),1,8,8,3500000,28000000,GETDATE(),GETDATE(),'SYSTEMA'),
('5019',GETDATE(),GETDATE(),6,2,1,2600000,2600000,GETDATE(),GETDATE(),'SYSTEMA'),
('5020',GETDATE(),GETDATE(),5,2,2,2600000,5200000,GETDATE(),GETDATE(),'SYSTEMA'),
('5021',GETDATE(),GETDATE(),3,2,4,2600000,10400000,GETDATE(),GETDATE(),'SYSTEMA'),
('5022',GETDATE(),GETDATE(),17,2,6,2600000,15600000,GETDATE(),GETDATE(),'SYSTEMA'),
('5023',GETDATE(),GETDATE(),16,2,7,2600000,18200000,GETDATE(),GETDATE(),'SYSTEMA'),
('5024',GETDATE(),GETDATE(),14,2,2,2600000,5200000,GETDATE(),GETDATE(),'SYSTEMA'),
('5025',GETDATE(),GETDATE(),13,2,1,2600000,2600000,GETDATE(),GETDATE(),'SYSTEMA'),
('5026',GETDATE(),GETDATE(),11,2,1,2600000,2600000,GETDATE(),GETDATE(),'SYSTEMA'),
('5027',GETDATE(),GETDATE(),4,5,3,1800000,5400000,GETDATE(),GETDATE(),'SYSTEMA'),
('5028',GETDATE(),GETDATE(),8,6,2,1800000,3600000,GETDATE(),GETDATE(),'SYSTEMA'),
('5029',GETDATE(),GETDATE(),5,7,1,2550000,2550000,GETDATE(),GETDATE(),'SYSTEMA'),
('5030',GETDATE(),GETDATE(),1,8,1,3500000,3500000,GETDATE(),GETDATE(),'SYSTEMA'),
('5031',GETDATE(),GETDATE(),1,3,1,2600000,2600000,GETDATE(),GETDATE(),'SYSTEMA'),
('5032',GETDATE(),GETDATE(),2,6,1,1800000,1800000,GETDATE(),GETDATE(),'SYSTEMA'),
('5033',GETDATE(),GETDATE(),4,5,1,1800000,1800000,GETDATE(),GETDATE(),'SYSTEMA'),
('5034',GETDATE(),GETDATE(),9,1,2,700000,1400000,GETDATE(),GETDATE(),'SYSTEMA'),
('5035',GETDATE(),GETDATE(),11,1,1,700000,700000,GETDATE(),GETDATE(),'SYSTEMA'),
('5036',GETDATE(),GETDATE(),7,4,1,2600000,2600000,GETDATE(),GETDATE(),'SYSTEMA'),
('5037',GETDATE(),GETDATE(),8,4,1,2600000,2600000,GETDATE(),GETDATE(),'SYSTEMA'),
('5038',GETDATE(),GETDATE(),9,6,2,1800000,3600000,GETDATE(),GETDATE(),'SYSTEMA'),
('5039',GETDATE(),GETDATE(),11,11,3,3200000,9600000,GETDATE(),GETDATE(),'SYSTEMA'),
('5040',GETDATE(),GETDATE(),1,6,1,1800000,1800000,GETDATE(),GETDATE(),'SYSTEMA'),
('5041',GETDATE()-25,GETDATE(),3,2,2,2600000,5200000,GETDATE(),GETDATE(),'SYSTEMA'), --se simulan ordes de fechas anteriores
('5042',GETDATE()-26,GETDATE(),5,2,3,2600000,7800000,GETDATE(),GETDATE(),'SYSTEMA'),
('5043',GETDATE()-27,GETDATE(),4,2,3,2600000,7800000,GETDATE(),GETDATE(),'SYSTEMA'),
('5044',GETDATE()-28,GETDATE(),4,2,1,2600000,2600000,GETDATE(),GETDATE(),'SYSTEMA'),
('5045',GETDATE()-29,GETDATE(),7,2,2,2600000,5200000,GETDATE(),GETDATE(),'SYSTEMA'),
('5046',GETDATE()-30,GETDATE(),9,4,1,2600000,2600000,GETDATE(),GETDATE(),'SYSTEMA'),
('5047',GETDATE()-31,GETDATE(),13,5,1,1800000,1800000,GETDATE(),GETDATE(),'SYSTEMA'),
('5048',GETDATE()-32,GETDATE(),7,4,1,2600000,2600000,GETDATE(),GETDATE(),'SYSTEMA'),
('5049',GETDATE()-33,GETDATE(),8,4,1,2600000,2600000,GETDATE(),GETDATE(),'SYSTEMA')


